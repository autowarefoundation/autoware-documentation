# Planning component design

## Overview

Planning stack acts as the “brain” of autonomous driving. It uses all the results from Localization, Perception, and Map stacks to decide its maneuver and gives final trajectory to Control stack.

## Role

These are high-level roles of Planning stack:

- Calculates route that navigates to desired goal
- Plans trajectory to follow the route
  - Make sure that vehicle does not collide with obstacles, including pedestrians and other vehicles
  - Make sure that the vehicle follows traffic rules during the navigation. This includes following traffic light, stopping at stoplines, stopping at crosswalks, etc.
- Plan sequences of trajectories that is feasible for the vehicle. (e.g. no sharp turns that is kinematically impossible)

## High-level architecture

This diagram describes the high-level architecture of the Planning Component.

![overall-planning-architecture](image/high-level-planning-diagram.drawio.svg)

The Planning Component works with the following other components:

- **Perception**: to receive perception result, e.g. detected objects, traffic light signal, etc.
- **Localization**: to receive localization result, e.g. ego-pose, speed, acceleration, etc.
- **Map**: to receive HD-map information.
- **Control**: to send the planning result to drive the vehicle.
- **System**: to send the diagnostic results, e.g. system failure, etc.
- **Human Machine Interface (HMI)**: to communicate with high-level API, e.g. to receive a goal, to send factors of the planning behavior.
- **API Layer**: to communicate with high-level API, e.g. to receive a goal, to send factors of the planning behavior.

## Component interface

The following describes the input/output message interface bewteen Planning Component and other components.

### Input

The table below summarizes the overall input into Planning stack:

| Input From Perception Component | Topic Name(Data Type)                                                                                               | Explanation                                                                                                                                                                                          |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Detected Object Information     | `/perception/object_recognition/objects`<br>(_autoware_auto_perception_msgs/msg/PredictedObjects_)                  | This includes information that cannot be known beforehand such as pedestrians and other vehicles. Planning stack will plan maneuvers to avoid collision with such objects.                           |
| Detected Obstacle Information   | `/perception/obstacle_segmentation/pointcloud`<br>(_sensor_msgs/msg/PointCloud2_)                                   | This includes information on the location of obstacles. This is more primitive information and is used for emergency stops, etc.                                                                     |
| Occupancy Map Information       | `/perception/occupancy_grid_map/map`<br>(_nav_msgs/msg/OccupancyGrid_)                                              | This includes information that cannot be known beforehand such as pedestrians and other vehicles. Planning stack will plan maneuvers to avoid collision with such objects.                           |
| TrafficLight recognition result | `/perception/traffic_light_recognition/traffic_signals`<br>(_autoware_auto_perception_msgs/msg/TrafficSignalArray_) | This is the real time information about the state of each traffic light. Planning stack will extract the one that is relevant to planned path and use it to decide whether to stop at intersections. |

| Input From Localization Component | Topic Name(Data Type)                                        | Explanation                                                |
| --------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| Vehicle Kinematics                | `/localization/kinematic_state`<br>(_nav_msgs/msg/Odometry_) | This includes ego vehicle's pose and velocity information. |
| Vehicle Acceleration              | `/localization/acceleration`<br>(\_)                         | This includes ego vehicle's acceleration.                  |

| Input From Map Component | Topic Name(Data Type)                                             | Explanation                                                                                                                                                                                                                                                                                                         |
| ------------------------ | ----------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Map data                 | `/map/vector_map`<br>(_autoware_auto_mapping_msgs/msg/HADMapBin_) | This includes all static information about the environment, such as: <ul><li>Lane connection information used for route planning from starting position to goal position</li><li>Lane geometry to generate reference path used to calculate trajectory </li><li> All information related to traffic rules</li></ul> |

| Input From HMI       | Topic Name(Data Type)                                        | Explanation                                                |
| -------------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| Vehicle Kinematics   | `/localization/kinematic_state`<br>(_nav_msgs/msg/Odometry_) | This includes ego vehicle's pose and velocity information. |
| Vehicle Acceleration | `/localization/acceleration`<br>(\_)                         | 自車加速度                                                 |

| Input From API Layer | Topic Name(Data Type)                                                      | Explanation                                                                                                                  |
| -------------------- | -------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| Goal position        | `/planning/mission_planning/goal`<br>(_geometry_msgs::PoseStamped_)        | This is the final pose that Planning stack will try to achieve.                                                              |
| Check point position | `/planning/mission_planning/check_point`<br>(_geometry_msgs::PoseStamped_) | This is the midpoint that Planning will try to go at on the way to the destination. This is used when calculating the route. |

### Output

The table below summarizes the final output from Planning stack:

| Output to Control Component | Topic(Data Type)                                                                            | Explanation                                                                                                                                                                                                                                  |
| --------------------------- | ------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Trajectory                  | `/planning/trajectory`<br>(_autoware_auto_planning_msgs/msg/Trajectory_)                    | This is the sequence of pose, twist and acceleration that Control stack must follow. This must be smooth, and kinematically possible to follow by the Control stack. By default, the trajectory is 10 seconds long at 0.1 second resolution. |
| Turn Signal                 | `/planning/turn_indicators_cmd`<br>(_autoware_auto_vehicle_msgs/msg/TurnIndicatorsCommand_) | This is the output to control turn signals of the vehicle. Planning stack will make sure that turn signal will be turned on according to planned maneuver.                                                                                   |
| Hazard Signal               | `/planning/hazard_lights_cmd`<br>(_autoware_auto_vehicle_msgs/msg/HazardLightsCommand_)     | This is the output to control hazard signals of the vehicle. Planning stack will make sure that hazard signal will be turned on according to planned maneuver.                                                                               |

| Output to System Component | Topic(Data Type)                                                 | Explanation |
| -------------------------- | ---------------------------------------------------------------- | ----------- |
| Diagnostics                | `/diagnostics`<br>(_autoware_auto_planning_msgs/msg/Trajectory_) | hogehoge    |

## Planning internal interface

## Implementation

The implementation of the planning module in the latest version is shown as below.

![reference-implementation](image/planning-diagram.drawio.svg)

For more details, please refer to the design documents in each package.

- [_mission_planner_](https://autowarefoundation.github.io/autoware.universe/main/planning/mission_planner/): calculate route from start to goal based on the map information.
- [_behavior_path_planner_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/): calculates path and drivable area based on the traffic rules.
  - [_lane_following_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/#lane-following)
  - [_lane_change_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/#lane-change)
  - [_avoidance_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/#avoidance)
  - [_pull_over_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/#pull-over)
  - [_pull_out_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/#pull-out)
  - _side_shift_
- [_behavior_velocity_planner_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/): calculates max speed based on the traffic rules.
  - [_detection_area_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/detection-area-design/)
  - [_blind_spot_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/blind-spot-design/)
  - [_cross_walk_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/crosswalk-design/)
  - [_stop_line_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/stop-line-design/)
  - [_traffic_light_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/traffic-light-design/)
  - [_intersection_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/intersection-design/)
  - [_no_stopping_area_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/no-stopping-area-design/)
  - [_virtual_traffic_light_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/virtual-traffic-light-design/)
  - [_occlusion_spot_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/occlusion-spot-design/)
  - [_run_out_](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/run-out-design/)
- [_obstacle_avoidance_planner_](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_avoidance_planner/): calculate path shape under obstacle and drivable area constraints
- [_surround_obstacle_checker_](https://autowarefoundation.github.io/autoware.universe/main/planning/surround_obstacle_checker/): keeps the vehicle being stopped when there are obstacles around the ego-vehicle. It works only when the vehicle is stopped.
- [_obstacle_stop_planner_](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_stop_planner/): When there are obstacles on or near the trajectory, it calculates the maximum velocity of the trajectory points depending on the situation: stopping, slowing down, or adaptive cruise (following the car).
  - [_stop_](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_stop_planner/#obstacle-stop-planner_1)
  - [_slow_down_](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_stop_planner/#slow-down-planner)
  - [_adaptive_cruise_](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_stop_planner/#adaptive-cruise-controller)
- [_costmap_generator_](https://autowarefoundation.github.io/autoware.universe/main/planning/costmap_generator/): generates a costmap for path generation from dynamic objects and lane information.
- [_freespace_planner_](https://autowarefoundation.github.io/autoware.universe/main/planning/freespace_planner/): calculates trajectory considering the feasibility (e.g. curvature) for the freespace scene. Algorithms are described [here](https://autowarefoundation.github.io/autoware.universe/main/planning/freespace_planning_algorithms/).
- _scenario_selector_ : chooses a trajectory according to the current scenario.
- [_external_velocity_limit_selector_](https://autowarefoundation.github.io/autoware.universe/main/planning/external_velocity_limit_selector/): takes an appropriate velocity limit from multiple candidates.
- [_motion_velocity_smoother_](https://autowarefoundation.github.io/autoware.universe/main/planning/motion_velocity_smoother/): calculates final velocity considering velocity, acceleration, and jerk constraints.

## Supported Functions

| No. | Feature                                         | Description                                                                                                                                                     | Requirements                                                                      | Reference Implementation                                                                                                                                                                                                                                                             | How to run                                                                                                       | Figure                                                                          |
| --- | ----------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| 1   | Route Planning                                  | Plan a route from the vehicle's position to the destination                                                                                                     | Lanelet map (driving lanelets)                                                    | [Mission Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/mission_planner/)                                                                                                                                                                             | `launch mission_planner`                                                                                         | ![route-planning](image/features-route-planning.drawio.svg)                     |
| 2   | Path Generation from Route                      | Generate a map from the driving lanelets                                                                                                                        | Lanelet map (driving lanelets)                                                    | Required                                                                                                                                                                                                                                                                             | `launch behavior_path_planner`                                                                                   | ![lane-follow](image/features-lane-follow.drawio.svg)                           |
| 3   | Lane Change                                     | Change lanes to reach the destination                                                                                                                           | Lanelet map (driving lanelets)                                                    | [Lane Change](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/docs/behavior_path_planner_lane_change_design/)                                                                                                                             | Enable flag in both parameters:                                                                                  | ![lane-change](image/features-lane-change.drawio.svg)                           |
| 4   | Obstacle Avoidance                              | Change the route to avoid obstacles                                                                                                                             | Recognized object information                                                     | [Avoidance](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/docs/behavior_path_planner_avoidance_design/), [Obstacle Avoidance Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_avoidance_planner/) | Enable flag in parameter: `launch obstacle_avoidance_planner true`                                               | ![obstacle-avoidance](image/features-avoidance.drawio.svg)                      |
| 5   | Obstacle Stop                                   | Stop if there is an obstacle on the route                                                                                                                       | Recognized object information                                                     | [Obstacle Stop Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_stop_planner/), [Obstacle Cruise Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_cruise_planner/)                                       | `launch obstacle_stop_planner` and enable flag: `TODO`, `launch obstacle_cruise_planner` and enable flag: `TODO` | ![obstacle-stop](image/features-obstacle-stop.drawio.svg)                       |
| 6   | Obstacle Deceleration                           | Deceerate if there is an obstacle near the route                                                                                                                | Recognized object information                                                     | [Obstacle Stop Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_stop_planner/), [Obstacle Cruise Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_cruise_planner/)                                       |                                                                                                                  | ![obstacle-decel](image/features-obstacle-decel.drawio.svg)                     |
| 7   | Adaptive Cruise Control                         | Adjust the vehicle's speed to match the speed of the vehicle in front of it if it is driving on the route                                                       | Recognized object information                                                     | [Obstacle Stop Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_stop_planner/), [Obstacle Cruise Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_cruise_planner/)                                       |                                                                                                                  | ![adaptive-cruise](image/features-adaptive-cruise.drawio.svg)                   |
| 8   | Surround check at starting                      | If there is an obstacle around when starting, continue stopping.                                                                                                | Object recognition information                                                    | [Surround Obstacle Checker](https://autowarefoundation.github.io/autoware.universe/main/planning/surround_obstacle_checker/)                                                                                                                                                         | -                                                                                                                | ![surround-check](image/features-surround-check.drawio.svg)                     |
| 9   | Deceleration on Curve                           | Decelerates the speed on a curve.                                                                                                                               | -                                                                                 | [Motion Velocity Smoother](https://autowarefoundation.github.io/autoware.universe/main/planning/motion_velocity_smoother/)                                                                                                                                                           | -                                                                                                                | ![decel-on-curve](image/features-decel-on-curve.drawio.svg)                     |
| 10  | Deceleration on Curve for Obstacle              | Decelerates the speed while considering nearby obstacles on a curve.                                                                                            | Object recognition information, lanelet map (obstacle information)                | [Obstacle Velocity Limiter](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_velocity_limiter/)                                                                                                                                                         | -                                                                                                                | ![decel-on-curve-obstacles](image/features-decel-on-curve-obstacles.drawio.svg) |
| 11  | Path smoothing                                  | Smooths the route and achieves smooth driving.                                                                                                                  | Lanelet map (driving lanelet)                                                     | [Obstacle Avoidance Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_avoidance_planner/)                                                                                                                                                       | -                                                                                                                | ![path-smoothing](image/features-path-smoothing.drawio.svg)                     |
| 12  | Narrow space driving                            | Plans the route to stay within the drivable area. If it goes out of the area, it plans to stop before the area.                                                 | Lanelet map (high-precision lane boundaries)                                      | [Obstacle Avoidance Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/obstacle_avoidance_planner/)                                                                                                                                                       | -                                                                                                                | ![narrow-space-driving](image/features-narrow-space-driving.drawio.svg)         |
| 13  | Pull Over                                       | Parks by hugging the shoulder lane.                                                                                                                             | Lanelet map (shoulder lane)                                                       | [Goal Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/docs/behavior_path_planner_goal_planner_design/)                                                                                                                           | -                                                                                                                | ![pull-over](image/features-pull-over.drawio.svg)                               |
| 14  | Pull Out                                        | Starts from the shoulder lane.                                                                                                                                  | Lanelet map (shoulder lane)                                                       | [Pull Out Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/docs/behavior_path_planner_pull_out_design/)                                                                                                                            | -                                                                                                                | ![pull-out](image/features-pull-out.drawio.svg)                                 |
| 15  | Path shift                                      | Shifts the path laterally in response to external instructions.                                                                                                 | -                                                                                 | [Side Shift Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_path_planner/docs/behavior_path_planner_side_shift_design/)                                                                                                                        | -                                                                                                                | ![side-shift](image/features-side-shift.drawio.svg)                             |
| 16  | Crosswalk                                       | Decelerates and plans to stop for pedestrians walking on or approaching a pedestrian crossing.                                                                  | Object recognition information, lanelet map (pedestrian crossing)                 | [Crosswalk Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/crosswalk-design/)                                                                                                                                                 | -                                                                                                                | ![crosswalk](image/features-crosswalk.drawio.svg)                               |
| 17  | Intersection Oncoming Vehicle Check             | Determine whether it is safe to enter an intersection while making a right or left turn by checking for oncoming vehicles                                       | Object recognition information and lanelet map (intersection lane and yield lane) | [Intersection Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/intersection-design/)                                                                                                                                           | -                                                                                                                | ![intersection](image/features-intersection.drawio.svg)                         |
| 18  | Intersection Blind Spot Check                   | Check for potential rear-end collisions with other vehicles or motorcycles when making a right or left turn at an intersection                                  | Object recognition information and lanelet map (intersection lane)                | [Intersection Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/intersection-design/)                                                                                                                                           | -                                                                                                                | ![blind-spot](image/features-blind-spot.drawio.svg)                             |
| 19  | Intersection Occlusion Check (WIP)              | Perform a head check while checking for oncoming vehicles at an intersection to consider blind spots                                                            | Object recognition information and lanelet map (intersection lane)                | [Intersection Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/intersection-design/)                                                                                                                                           | -                                                                                                                |                                                                                 |
| 20  | Intersection Traffic Jam Detection              | Stop before entering an intersection if there is a traffic jam ahead                                                                                            | Object recognition information and lanelet map (intersection lane)                | [Intersection Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/intersection-design/)                                                                                                                                           | -                                                                                                                | ![intersection-traffic-jam](image/features-intersection-traffic-jam.drawio.svg) |
| 21  | Traffic Light Stop                              | Stop and go according to the state of the traffic lights                                                                                                        | Traffic light recognition information                                             | [Traffic Light Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/traffic-light-design/)                                                                                                                                         | -                                                                                                                | ![traffic-light](image/features-traffic-light.drawio.svg)                       |
| 22  | Run-out Check                                   | Plan deceleration to account for the possibility of objects near the path running out into it                                                                   | Object recognition information                                                    | [Run Out Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/run-out-design/)                                                                                                                                                     | -                                                                                                                | ![run-out](image/features-run-out.drawio.svg)                                   |
| 23  | Stop Line                                       | Plan a stop at stop lines                                                                                                                                       | Lanelet map (stop line)                                                           | [Stop Line Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/stop-line-design/)                                                                                                                                                 | -                                                                                                                | ![stop-line](image/features-stop-line.drawio.svg)                               |
| 24  | Occlusion Spot Check                            | Plan deceleration to account for objects running out from occlusion spots                                                                                       | Object recognition information and lanelet map (private/public lane)              | [Occlusion Spot Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/occlusion-spot-design/)                                                                                                                                       | -                                                                                                                | ![occlusion-spot](image/features-occlusion-spot.drawio.svg)                     |
| 25  | No Stopping Area                                | Stop before the area to avoid stopping in a no-stopping area                                                                                                    | Lanelet map (no stopping area)                                                    | [No Stopping Area Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/no-stopping-area-design/)                                                                                                                                   | -                                                                                                                | ![no-stopping-area](image/features-no-stopping-area.drawio.svg)                 |
| 26  | Merge from Private Area to Public Road          | Check for safety with other vehicles when merging onto a public road from a private area                                                                        | -                                                                                 | [Merge from Private Area Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/merge-from-private-design/)                                                                                                                          | -                                                                                                                |                                                                                 |
| 27  | Speed Bump                                      | Plan deceleration for speed bumps                                                                                                                               | lanelet map (speed_bump)                                                          | [Speed Bump Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/speed-bump-design/)                                                                                                                                               | -                                                                                                                |                                                                                 |
| 28  | Detection Area                                  | Detection Area                                                                                                                                                  | lanelet map (obstacle detection area)                                             | [Detection Area Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/detection-area-design/)                                                                                                                                       | -                                                                                                                | ![detection-area](image/features-detection-area.drawio.svg)                     |
| 29  | Collision detection when deviating from lane    | Adjust speed to avoid conflict with other vehicles driving in the deviated lane when deviating from own lane                                                    | -                                                                                 | [Out of Lane Module](https://autowarefoundation.github.io/autoware.universe/main/planning/behavior_velocity_planner/out-of-lane-design/)                                                                                                                                             | -                                                                                                                |                                                                                 |
| 30  | Stop planning to avoid entering out of ODD area | lanelet map (invalid lane)                                                                                                                                      | WIP                                                                               | -                                                                                                                                                                                                                                                                                    | -                                                                                                                |                                                                                 |
| 31  | Parking planning                                | Plan parking for given goal in parking area                                                                                                                     | Obstacle information and lanelet map (obstacle detection area)                    | [Free Space Planner](https://autowarefoundation.github.io/autoware.universe/main/planning/freespace_planner/)                                                                                                                                                                        | -                                                                                                                | ![parking](image/features-parking.drawio.svg)                                   |
| 32  | Minimum Risk Manuver (MRM)                      | Support appropriate actions such as gradual stop or roadside parking depending on driving conditions such as sensor failure or recognition accuracy degradation | TODO                                                                              | TODO                                                                                                                                                                                                                                                                                 | -                                                                                                                |                                                                                 |
| 33  | Planning Validation                             | Determine if the planned trajectory is safe and appropriate                                                                                                     | TODO                                                                              | [Planning Validator](https://autowarefoundation.github.io/autoware.universe/main/planning/planning_validator/)                                                                                                                                                                       | -                                                                                                                |                                                                                 |
| 34  | Running Lane Map Generation                     | Generate lane map from manually driven path                                                                                                                     | -                                                                                 | WIP                                                                                                                                                                                                                                                                                  | TODO                                                                                                             |                                                                                 |
| 35  | Running Lane Optimization                       | Optimize route for the centerline (reference path) of the running lane map                                                                                      | TODO                                                                              | [Static Centerline Optimizer](https://autowarefoundation.github.io/autoware.universe/main/planning/static_centerline_optimizer/)                                                                                                                                                     | -                                                                                                                |                                                                                 |

<!-- ![supported-functions](image/planning-functions.drawio.svg) -->

## Important Parameters

| Package                      | Parameter                                                     | Type   | Description                                                                                                        |
| ---------------------------- | ------------------------------------------------------------- | ------ | ------------------------------------------------------------------------------------------------------------------ |
| `obstacle_stop_planner`      | `stop_planner.stop_position.max_longitudinal_margin`          | double | distance between the ego and the front vehicle when stopping (when `cruise_planner_type:=obstacle_stop_planner`)   |
| `obstacle_cruise_planner`    | `common.safe_distance_margin`                                 | double | distance between the ego and the front vehicle when stopping (when `cruise_planner_type:=obstacle_cruise_planner`) |
| `behavior_path_planner`      | `avoidance.avoidance.lateral.lateral_collision_margin`        | double | minimum lateral margin to obstacle on avoidance                                                                    |
| `behavior_path_planner`      | `avoidance.avoidance.lateral.lateral_collision_safety_buffer` | double | additional lateral margin to obstacle if possible on avoidance                                                     |
| `obstacle_avoidance_planner` | `option.enable_outside_drivable_area_stop`                    | bool   | If set true, a stop point will be inserted before the path footprint is outside the drivable area.                 |

## Notation

### [1] self-crossing road and overlapped

To support the self-crossing road and overlapped road in the opposite direction, each planning module has to meet the [specifications](https://autowarefoundation.github.io/autoware.universe/main/common/motion_utils/)

Currently, the supported modules are as follows.

- lane_following (in behavior_path_planner)
- detection_area (in behavior_velocity_planner)
- stop_line (in behavior_velocity_planner)
- virtual_traffic_light (in behavior_velocity_planner)
- obstacle_avoidance_planner
- obstacle_stop_planner
- motion_velocity_smoother

### [2] Size of Path Points

Some functions do not support paths with only one point. Therefore, each modules should generate the path with more than two path points.
